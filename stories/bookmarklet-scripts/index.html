<!DOCTYPE html> <html> <head> <title>Bookmarklet Scripts</title> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Bookmarklet allows you to run some script by clicking them after adding those to your browser as bookmarks. When your users click the bookmark, the script ru..."> <meta name="author" content="Hanzel Jesheen"> <meta itemprop="name" content="Bookmarklet Scripts"> <meta itemprop="description" content="Bookmarklet allows you to run some script by clicking them after adding those to your browser as bookmarks. When your users click the bookmark, the script ru..."> <link rel="canonical" href="https://botleg.com/stories/bookmarklet-scripts/"> <link rel="alternate" type="application/rss+xml" title="Botleg" href="https://botleg.com/feed" /> </head> <body> <div class="page-content"> <div class="post"> <header style="background:rgb(192, 57, 43);background:linear-gradient(90deg, rgb(192, 57, 43) 25%, rgb(231, 76, 60) 100%);background:-moz-linear-gradient(left, rgb(192, 57, 43) 25%, rgb(231, 76, 60) 100%);background:-webkit-linear-gradient(left, rgb(192, 57, 43) 25%, rgb(231, 76, 60) 100%);background:-o-linear-gradient(left, rgb(192, 57, 43) 25%, rgb(231, 76, 60) 100%);background:-ms-linear-gradient(left, rgb(192, 57, 43) 25%, rgb(231, 76, 60) 100%);"> <section class="site-header"> <div class="wrapper"> <a class="site-title" href="/">Botleg</a> <div id="search"> <a href="/feed/index.xml"><span class="rss-icon"> <svg viewBox="0 0 24 24" width="30px" height="30px"> <use xlink:href="/assets/images/sprites.svg#rss"></use> </svg></span> </a> <form id="searchform"> <input type="text" placeholder="search" id="searchbox"> </form> </div> </div> </section> <section class="post-header"> <div class="header-content"> <h1 class="post-title">Bookmarklet Scripts</h1> <a class="icon gh" href="https://gist.github.com/hanzeljesheen/b056fe4319955ce14b53" target="blank"><span>View Code</span></a> </div> </section> </header> <div class="wrapper"> <section> <article class="post-content"> <p class="post-meta">Written by Hanzel Jesheen on Dec 30, 2015 | <a href="/categories/javascript">javascript</a> </p> <p>Bookmarklet allows you to run some script by clicking them after adding those to your browser as bookmarks. When your users click the bookmark, the script runs on the current page that the user is on and that information can be used. In this article, we will see how to create a bookmarklet script to send your current page with some tags via <code class="highlighter-rouge">AJAX</code> requests. We will also look into how to identify and authenticate users who are clicking this bookmarklet. You can see the code for the script <a href="https://gist.github.com/hanzeljesheen/b056fe4319955ce14b53">here</a>.</p> <h2 id="the-basic-idea">The Basic Idea</h2> <p>The bookmarklet script is a piece of javascript code that you can save as the bookmark. When the bookmarklet is clicked, the javascript code will be executed. The javascript code will be enclosed in an anonymous function which is called as soon as it’s defined. We enclose the function with parenthesis and prepend it with <code class="highlighter-rouge">javascript:</code> to tell the browser that the code is infact javascript.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">javascript</span><span class="err">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// your script here.</span>
<span class="p">}());</span></code></pre></figure> <p>This is the basic structure of a bookmarklet script and we can minify this to a single line.</p> <h2 id="ajax-request">AJAX Request</h2> <p>One of the basic thing that we need with a bookmarklet script is to send something to a server. This can be done in javascript with AJAX requests. You can read more about AJAX requests <a href="http://www.w3schools.com/ajax/ajax_xmlhttprequest_send.asp">here</a>.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">javascript</span><span class="err">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"POST"</span><span class="p">,</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="s2">"http://localhost:8080"</span><span class="p">));</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
  	<span class="na">url</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span>
  <span class="p">}));</span>
<span class="p">}());</span></code></pre></figure> <p>Here, we are sending a <code class="highlighter-rouge">POST</code> request to <code class="highlighter-rouge">http://localhost:8080</code>. We can get the current page address with <code class="highlighter-rouge">document.location.href</code> and we are sending this as the body of the POST request.</p> <p>One thing to note here is <code class="highlighter-rouge">CORS</code>. The origin of the AJAX request will be from the user’s current page URL, which won’t have the same domain as the the destination of the request. This make the request <code class="highlighter-rouge">cross-domain</code>. For example, if you are clicking the bookmarklet when you are in <code class="highlighter-rouge">google.com</code>, your origin is <code class="highlighter-rouge">google.com</code> and destination is <code class="highlighter-rouge">localhost</code>. To allow such <code class="highlighter-rouge">cross-domain</code> request, the server must set the following headers.</p> <figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="s">Access-Control-Allow-Origin</span><span class="pi">:</span> <span class="s1">'</span><span class="s">*'</span>
<span class="s">Access-Control-Request-Method</span><span class="pi">:</span> <span class="s1">'</span><span class="s">*'</span>
<span class="s">Access-Control-Allow-Methods</span><span class="pi">:</span> <span class="s1">'</span><span class="s">POST'</span>
<span class="s">Access-Control-Allow-Headers</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Content-Type'</span></code></pre></figure> <h2 id="ui-elements">UI Elements</h2> <p>Now that we have sent location of the page, let’s also send some tags that the user can input. For this we need a form with text field and a button, the UI elements. To achieve this with out script, we save the required HTML as a string and add that to out page.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">javascript</span><span class="err">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="s1">'
    &lt;div id="bookmarklet" style="
      position:fixed;
      background: #FFF;
      border: 1px #000 solid;
      right:50px;
      top:50px;
      z-index:1000;
      width:250px;
    "&gt;
    Tag: &lt;input type="text" id="tag-input"&gt;
    &lt;button id="add-tag"&gt;Submit&lt;/button&gt;&lt;/div&gt;'</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="nx">el</span><span class="p">;</span>
<span class="p">}());</span></code></pre></figure> <p>Here, we have a <code class="highlighter-rouge">div</code> with a textfield and a button saved as string in <code class="highlighter-rouge">el</code> variable. This variable is then added to our page and this gives us the HTML elements in the current page. We use the <code class="highlighter-rouge">position:fixed</code> and <code class="highlighter-rouge">z-index:1000</code> property on the enclosing <code class="highlighter-rouge">div</code> to make the box floating on top of the current page.</p> <p>Make sure that you style all the elements in your UI with custom CSS. Otherwise, these elements will inherit the current page’s CSS properties. That could make your UI look different when opened in different pages.</p> <p>Once new elements are added to the current page, we can make the AJAX request with the <code class="highlighter-rouge">click</code> event on the button. To make this happen, add the following to the end of your script, before the anonymous function ends.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'add-tag'</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"POST"</span><span class="p">,</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="s2">"http://localhost:8080"</span><span class="p">));</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
    <span class="na">tags</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'tag-input'</span><span class="p">).</span><span class="nx">value</span>
  <span class="p">}));</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'bookmarklet'</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
<span class="p">});</span></code></pre></figure> <h2 id="authentication">Authentication</h2> <p>If you have a cookie based authenication system and the user has logged in to your site, every request to your site will have the cookie details in its header. We can use that for authentication. There is however a caveat, the browsers don’t send the cookie details for cross-domain AJAX requests by default. So, we need to add the following line before send the <code class="highlighter-rouge">POST</code> request.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></code></pre></figure> <p>So the entire code for the bookmarklet script will look like this.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">javascript</span><span class="err">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="s1">'
    &lt;div id="bookmarklet" style="
      position:fixed;
      background: #FFF;
      border: 1px #000 solid;
      right:50px;
      top:50px;
      z-index:1000;
      width:250px;
    "&gt;
    Tag: &lt;input type="text" id="tag-input"&gt;
    &lt;button id="add-tag"&gt;Submit&lt;/button&gt;&lt;/div&gt;'</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="nx">el</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'add-tag'</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"POST"</span><span class="p">,</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="s2">"http://localhost:8080"</span><span class="p">));</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
      <span class="na">tags</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'tag-input'</span><span class="p">).</span><span class="nx">value</span>
    <span class="p">}));</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'bookmarklet'</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}());</span></code></pre></figure> <h2 id="conclusion">Conclusion</h2> <p>In this article, we have seen how to create bookmarklet scripts that can send AJAX requests, create UI elements and even do authentication.</p> <p class="post-meta">Tags: bookmarklet, script, bookmark, ajax, requests, ui, post, cors, cross-domain, cookie, and javascript </p> </article> <article class="post-comments" id="comments-box"> <h1 class="page-title">Comments</h1> <form id="new-comment"> <input type="text" id="nameField" placeholder="Enter your name" required><br/> <textarea id="textField" placeholder="Your comments please." required></textarea><br/> <button type="submit" id="commentBtn">Post Comment</button> </form> <div id="comments"></div> </article> </section> <aside class="post-aside"> <div class ="aside" id="cat-list"> <h1 class="page-heading">Categories</h1> <a href="/categories/misc">Misc</a><br/> <a href="/categories/jekyll">Jekyll</a><br/> <a href="/categories/cloud">Cloud</a><br/> <a href="/categories/Node.js">Node.js</a><br/> <a href="/categories/javascript">Javascript</a><br/> <a href="/categories/devops">Devops</a><br/> </div> <div class ="aside"> <h1 class="page-heading">Related Stories</h1> <a href=/stories/using-your-sessions-with-socketio/>Using your sessions with Socket.IO</a><br/><a href=/stories/implement-elasticsearch-in-jekyll-blog/>Implement Elasticsearch in Jekyll blog</a><br/><a href=/stories/tricks-with-ssh/>Tricks with SSH</a><br/><a href=/stories/hello-world/>hello world :)</a><br/><a href=/stories/line-numbers-in-jekyll-code-blocks/>Line numbers in Jekyll code blocks</a><br/> </div> <p class="rss-subscribe">subscribe <a href="/feed">via RSS</a></p> <a href="#">Scroll to Top</a> </aside> </div> </div> </div> <footer class="site-footer"> <div class="footer-wrap"> <h2 class="footer-heading"><a href="/">botleg</a></h2> <div class="footer-col-wrapper"> <div class="footer-col footer-col-1"> <ul class="contact-list"> <li>By Hanzel Jesheen</li> <li><a href="mailto:blog@botleg.com">blog@botleg.com</a></li> </ul> </div> <div class="footer-col footer-col-2"> <ul class="social-media-list"> <li> <a href="https://github.com/botleg"> <span class="footer-icon"> <svg viewBox="0 0 16 16" width="16px" height="16px"> <use xlink:href="/assets/images/sprites.svg#gh"></use> </svg> </span> <span class="username">github</span> </a> </li> <li class="username"> <span class="footer-icon"> <svg viewBox="0 0 24 24" width="16px" height="16px"> <use xlink:href="/assets/images/sprites.svg#rss"></use> </svg> </span> subscribe <a href="/feed">via RSS</a> </li> </ul> </div> <div class="footer-col footer-col-3"> <p>Hi, botleg is a blog where you can find tutorials and techniques in web development, devops, databases, cloud computing and anything related to technology.</p> </div> </div> </div> </footer> <style type="text/css">body,h1,h2{font-weight:300}.wrapper:after{clear:both}html{box-sizing:border-box}body{background-color:#fdfdfd;color:#111;font-family:Helvetica,Arial,sans-serif;font-size:18px;line-height:1.6;}.wrapper section{margin-top:30px}a{color:#2a7ae2;text-decoration:none}.site-header{min-height:60px;position:relative}.site-title{margin-bottom:0;float:left;font-size:28px;line-height:60px;text-transform:lowercase;color:#e8e8e8}.post-header{box-align:center;justify-content:center;color:#fdfdfd;display:flex;height:300px;margin-bottom:10px}.rss-icon,#searchbox{display:none;}.post-header .header-content{text-align:center;max-width:600px}.icon{background-position:10px center;background-repeat:no-repeat;background-size:30px;padding:0 30px 0 45px}.icon span{color:#fdfdfd;display:none}@media screen and (min-width:400px){.icon span{display:inline}}.post-title{color:#e8e8e8;font-size:36px}.page-content,.post-content{margin-bottom:20px}.page-content h2,.post-content h2{font-size:32px}</style> <script> var cb = function() { var l = document.createElement('link'); l.rel = 'stylesheet'; l.href = '/assets/main.css?v310'; var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h); }; var raf = requestAnimationFrame || mozRequestAnimationFrame || webkitRequestAnimationFrame || msRequestAnimationFrame; if (raf) raf(cb); else window.addEventListener('load', cb); </script> <script async type="text/javascript" src="/assets/js/post.js"></script> </body> </html>
