<!DOCTYPE html> <html> <head> <title>Using your sessions with Socket.IO</title> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content=" Socket.IO enables real-time bidirectional event-based communication."> <meta name="author" content="Hanzel Jesheen"> <meta itemprop="name" content="Using your sessions with Socket.IO"> <meta itemprop="description" content=" Socket.IO enables real-time bidirectional event-based communication."> <link rel="canonical" href="http://botleg.com/stories/using-your-sessions-with-socketio/"> <link rel="alternate" type="application/rss+xml" title="Botleg" href="http://botleg.com/feed" /> </head> <body> <header class="site-header"> <div class="wrapper"> <a class="site-title" href="/">Botleg</a> <div id="search"> <form id="searchform"> <input type="text" placeholder="search" id="searchbox"> </form> </div> </div> </header> <div class="page-content"> <div class="post"> <header class="post-header" style="background:#185a9d;background: -webkit-linear-gradient(90deg, #43cea2 10%, #185a9d 90%);background:-moz-linear-gradient(90deg, #43cea2 10%, #185a9d 90%);background:-ms-linear-gradient(90deg, #43cea2 10%, #185a9d 90%);background:-o-linear-gradient(90deg, #43cea2 10%, #185a9d 90%);background:linear-gradient(90deg, #43cea2 10%, #185a9d 90%);"> <div class="header-content"> <h1 class="post-title">Using your sessions with Socket.IO</h1> <a class="icon gh" href="https://github.com/botleg/socketio-sessions" target="blank"><span>View Code</span></a> <a class="icon code" href="http://socketio.sessions.botleg.com/" target="blank"><span>View Demo</span></a> </div> </header> <div class="wrapper"> <section> <article class="post-content"> <p class="post-meta">Written by Hanzel Jesheen on Sep 25, 2015 | <a href="/categories/Node.js">Node.js</a> </p> <blockquote> <p>Socket.IO enables real-time bidirectional event-based communication.</p> </blockquote> <p><a href="http://socket.io/">Socket.IO</a> uses web sockets for communication between the Node.js server and its clients. If client emits an event with some data, server can listen to it and use the data, and vice versa. The server can also broadcast events to all clients. In this article, we will see how to use our site’s sessions for authentication with Socket.IO.</p> <p>The entire code for the application can be found <a href="https://github.com/botleg/socketio-sessions">here</a> and the working demo is deployed <a href="http://socketio.sessions.botleg.com/">here</a>. We have a small chat application. When a new user opens the application, he gets a session with a random number as his <code class="highlighter-rouge">user id</code>. This is required by Socket.IO for authentication.</p> <h2 id="the-basic-app">The Basic App</h2> <p>We start with a simple chat application made in Node.js with <a href="http://koajs.com/">Koa</a> web framework. The code at this point can be found at the <code class="highlighter-rouge">before-session</code> tag of the code repository <a href="https://github.com/botleg/socketio-sessions/tree/before-session">here</a>.</p> <p>The server file, <code class="highlighter-rouge">index.js</code> creates a Koa server and serves a static folder <code class="highlighter-rouge">public</code> which contains a HTML page and a javascript file. It then connects this server to Socket.IO. The code looks like this.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'koa'</span><span class="p">)(),</span>
    <span class="nx">serve</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'koa-static'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">IP</span> <span class="o">=</span> <span class="s1">'127.0.0.1'</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">serve</span><span class="p">(</span><span class="s1">'./public'</span><span class="p">));</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">).</span><span class="nx">Server</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">callback</span><span class="p">()),</span>
    <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'socket.io'</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connection'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'send chat'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">io</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'new chat'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="nx">IP</span><span class="p">);</span></code></pre></figure> <p>The client, <code class="highlighter-rouge">public/app.js</code> connects to Socket.IO and sends the chat message to server by emitting <code class="highlighter-rouge">send chat</code> event and listens for <code class="highlighter-rouge">new chat</code> event for any new messages from other users. Note that we are only sending the message to the server and nothing about the user.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(),</span>
    <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'chatForm'</span><span class="p">),</span>
    <span class="nx">msgBox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'msgBox'</span><span class="p">),</span>
    <span class="nx">chatBox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'chatBox'</span><span class="p">);</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'new chat'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">chatBox</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span> <span class="o">+</span> <span class="s1">'&lt;hr/&gt;'</span> <span class="o">+</span> <span class="nx">chatBox</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">newMsg</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">msgBox</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'send chat'</span><span class="p">,</span> <span class="p">{</span> <span class="na">msg</span><span class="p">:</span> <span class="nx">msgBox</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="p">});</span>
    <span class="nx">msgBox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">){</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="nx">newMsg</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">){</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">'onsubmit'</span><span class="p">,</span> <span class="nx">newMsg</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <h2 id="adding-sessions">Adding Sessions</h2> <p>To add session authentication to Socket.IO, we only need to make the change in the server side code. That is the <code class="highlighter-rouge">index.js</code> file. First, we need to install two modules, <code class="highlighter-rouge">koa-session</code> and <code class="highlighter-rouge">cookie</code>.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">npm install --save koa-session
npm install --save cookie</code></pre></figure> <p>Require these from <code class="highlighter-rouge">index.js</code> page and set up <code class="highlighter-rouge">koa-session</code> with some secret key.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'cookie'</span><span class="p">),</span>
    <span class="nx">serve</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'koa-static'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'my secret key'</span><span class="p">];</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">(</span><span class="nx">app</span><span class="p">));</span></code></pre></figure> <p>Now, we’ll create a session for all users with some random number as the username. However, we only need to create a new session if one doesn’t already exist. This way, a user will have the same username even if he closes the app and reopens it. Also, we need to put all these middleware functions before serving the public folder.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="o">*</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">yield</span> <span class="nx">next</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure> <p><code class="highlighter-rouge">koa-session</code> will generate two cookies, <code class="highlighter-rouge">koa:sess</code> and <code class="highlighter-rouge">koa:sess.sig</code>. We are interested in <code class="highlighter-rouge">koa:sess</code>. It contains all the data we put in to the session and some default values in <code class="highlighter-rouge">base64 encoded</code> format. After decoding, it will contain something like this.</p> <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="mi">1095</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_expire"</span><span class="p">:</span><span class="mi">1443197611494</span><span class="p">,</span><span class="w">
  </span><span class="nt">"_maxAge"</span><span class="p">:</span><span class="mi">86400000</span><span class="w">
</span><span class="p">}</span></code></pre></figure> <p>Now, we can get to Socket.IO authorization. You can define custom authorization for Socket.IO with this function.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"authorization"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">accept</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//FOR SUCCESS</span>
  <span class="nx">accept</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="c1">//FOR FAILURE</span>
  <span class="k">return</span> <span class="nx">accept</span><span class="p">(</span><span class="s1">'Error Message.'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure> <p>Only if we send <code class="highlighter-rouge">accept(null, true);</code>, the web-socket handshake happens and we can communicate with it.</p> <p>Here, we need to parse the cookies, which is available in <code class="highlighter-rouge">data.headers.cookie</code> to obtain <code class="highlighter-rouge">koa:sess</code> cookie. We then decode it and extract <code class="highlighter-rouge">name</code> from it. We will store this in <code class="highlighter-rouge">data.name</code>. We will only allow connections if the cookie exists with a <code class="highlighter-rouge">name</code>.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"authorization"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">accept</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'koa:sess'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)[</span><span class="s1">'koa:sess'</span><span class="p">];</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">cookie</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">)).</span><span class="nx">name</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">accept</span><span class="p">(</span><span class="s1">'No cookie transmitted.'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">accept</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure> <p>If you are using some sort of session store with a database. You can get the user data required by quering the database with the cookie.</p> <p>Now, the <code class="highlighter-rouge">name</code> that we added to data object during authorization can be accessed from <code class="highlighter-rouge">socket.request.name</code>. So, we can modify the <code class="highlighter-rouge">send chat</code> event listener to include the user ID.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'send chat'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">;</span>
  <span class="nx">io</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'new chat'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure> <p>That’s all we need to do to incorporate our sessions to Socket.IO. The complete server side code now looks like this.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'koa'</span><span class="p">)(),</span>
    <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'koa-session'</span><span class="p">),</span>
    <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'cookie'</span><span class="p">),</span>
    <span class="nx">serve</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'koa-static'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">IP</span> <span class="o">=</span> <span class="s1">'127.0.0.1'</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'my secret key'</span><span class="p">];</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">(</span><span class="nx">app</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="o">*</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">yield</span> <span class="nx">next</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">serve</span><span class="p">(</span><span class="s1">'./public'</span><span class="p">));</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">).</span><span class="nx">Server</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">callback</span><span class="p">()),</span>
    <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'socket.io'</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"authorization"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">accept</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'koa:sess'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)[</span><span class="s1">'koa:sess'</span><span class="p">];</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">cookie</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">)).</span><span class="nx">name</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">accept</span><span class="p">(</span><span class="s1">'No cookie transmitted.'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">accept</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connection'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'send chat'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">;</span>
    <span class="nx">io</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'new chat'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="nx">IP</span><span class="p">);</span></code></pre></figure> <h2 id="conclusion">Conclusion</h2> <p>In this article, we have seen how to use sessions to authenticate user while connecting to Socket.IO. This enables us to provide security for data communication with web sockets and store the user data persistently.</p> <p class="post-meta">Tags: socket.io, session, koa, cookie, web-sockets, popular, and Node.js </p> </article> <article class="post-comments" id="comments-box"> <h1 class="page-title">Comments</h1> <form id="new-comment"> <input type="text" id="nameField" placeholder="Enter your name" required><br/> <textarea id="textField" placeholder="Your comments please." required></textarea><br/> <button type="submit" id="commentBtn">Post Comment</button> </form> <div id="comments"></div> </article> </section> <aside> <div class ="aside" id="cat-list"> <h1 class="page-heading">Categories</h1> <a href="/categories/misc">Misc</a><br/> <a href="/categories/jekyll">Jekyll</a><br/> <a href="/categories/cloud">Cloud</a><br/> <a href="/categories/Node.js">Node.js</a><br/> <a href="/categories/javascript">Javascript</a><br/> </div> <div class ="aside"> <h1 class="page-heading">Related Stories</h1> <a href=/stories/hello-world/>hello world :)</a><br/><a href=/stories/line-numbers-in-jekyll-code-blocks/>Line numbers in Jekyll code blocks</a><br/><a href=/stories/bookmarklet-scripts/>Bookmarklet Scripts</a><br/><a href=/stories/build-and-deploy-to-openshift-with-travisci-and-wercker/>Build and Deploy to OpenShift with TravisCI and Wercker</a><br/><a href=/stories/tricks-with-ssh/>Tricks with SSH</a><br/> </div> <p class="rss-subscribe">subscribe <a href="/feed">via RSS</a></p> <a href="#">Scroll to Top</a> </aside> </div> </div> </div> <footer class="site-footer"> <div class="footer-wrap"> <h2 class="footer-heading">Botleg</h2> <div class="footer-col-wrapper"> <div class="footer-col footer-col-1"> <ul class="contact-list"> <li>By Hanzel Jesheen</li> <li><a href="mailto:blog@botleg.com">blog@botleg.com</a></li> <li> <a href="https://github.com/botleg"><span class="username">botleg </span> <span class="icon"> <svg viewBox="0 0 16 16" width="16px" height="16px"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> </a> </li> </ul> </div> <div class="footer-col footer-col-2"> <ul class="social-media-list"> <li><a href="https://github.com/hanzeljesheen"><span class="username">github</span></a></li> <li><a href="https://bitbucket.org/hanzel"><span class="username">bitbucket</span></a></li> </ul> </div> <div class="footer-col footer-col-3"> <p>Hi, botleg is a blog where you can find tutorials and techniques in web development, big data analysis, databases, cloud computing and anything related to technology.</p> </div> </div> </div> </footer> <script> var cb = function() { var l = document.createElement('link'); l.rel = 'stylesheet'; l.href = '/assets/main.css?v200'; var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h); }; var raf = requestAnimationFrame || mozRequestAnimationFrame || webkitRequestAnimationFrame || msRequestAnimationFrame; if (raf) raf(cb); else window.addEventListener('load', cb); </script> <script type="text/javascript" src="/assets/js/home.js"></script> </body> </html>
